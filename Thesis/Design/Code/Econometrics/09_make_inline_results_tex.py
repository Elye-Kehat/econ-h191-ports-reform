#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
09_make_inline_results_tex.py
------------------------------------
Reads Step-08 table artifacts and emits ONE LaTeX section that inlines
all tables (no \input), ready to paste into Overleaf after econometrics
and before the bibliography.
"""

from pathlib import Path
import os

# ======= User toggles =======
OUTFILE = Path("Design/Output Data/09_results_tables_inline.tex")
TBL1    = Path("Design/Output Data/08_table1_main.tex")
TBL2    = Path("Design/Output Data/08_table2_dynamic_pooled.tex")
# ============================

HEADER = r"""\clearpage
% ====================== Results — Tables (inline) ======================
% Paste this block AFTER the econometrics section and BEFORE the bibliography.
% Requires in preamble: \usepackage{booktabs} \usepackage{threeparttable} (optional)
\providecommand{\sym}[1]{\ifmmode^{#1}\else\(^{#1}\)\fi}

\section{Results — Tables}
"""

SUBSEC1 = r"""
\subsection{Main Results (Average Post-Reform Effect on ln(LP))}
% The table below is fully inlined (no \input). It was generated by Step 08.
"""

SUBSEC2 = r"""
\subsection{Dynamic Event-Time Estimates (Pooled)}
% The table below is fully inlined (no \input). It was generated by Step 08.
"""

FOOT = r"""
% ====================== End Results — Tables (inline) ======================
"""

def read_text_or_placeholder(p: Path, title: str) -> str:
    if p.exists():
        return p.read_text(encoding="utf-8")
    return (
        "\\begin{table}[!htbp]\n\\centering\n"
        f"\\caption{{{title} — (artifact not found)}}\n"
        "\\begin{tabular}{lc}\n\\toprule\nNotice & Step-08 artifact missing \\\\\n\\midrule\n"
        f"{p.as_posix()} & not found \\\\\n\\bottomrule\n\\end{tabular}\n\\end{table}\n"
    )

def main():
    # Try to cd to project root if script lives under Design/Code/Econometrics/
    here = Path(__file__).resolve()
    try:
        os.chdir(here.parents[3])  # .../Thesis
    except Exception:
        os.chdir(here.parent)

    OUTFILE.parent.mkdir(parents=True, exist_ok=True)

    body = []
    body.append(HEADER)
    body.append(SUBSEC1)
    body.append(read_text_or_placeholder(TBL1, "Main Results — Average Post-Reform Effect on ln(LP)"))
    body.append(SUBSEC2)
    body.append(read_text_or_placeholder(TBL2, "Event-Time Estimates — Pooled Entrant and Legacy"))
    body.append(FOOT)

    OUTFILE.write_text("".join(body), encoding="utf-8")
    print(f"[09] Wrote inline LaTeX section to: {OUTFILE}")

if __name__ == "__main__":
    main()
